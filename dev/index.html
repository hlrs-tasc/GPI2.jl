<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · GPI2.jl</title><script data-outdated-warner src="assets/warner.js"></script><link rel="canonical" href="https://hlrs-tasc.github.io/GPI2.jl/dev/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.044/juliamono.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>GPI2.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li><a class="tocitem" href="#Configuration"><span>Configuration</span></a></li><li><a class="tocitem" href="#Authors"><span>Authors</span></a></li><li><a class="tocitem" href="#License-and-contributing"><span>License and contributing</span></a></li></ul></li><li><a class="tocitem" href="reference/">Reference</a></li><li><a class="tocitem" href="license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/hlrs-tasc/GPI2.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="GPI2.jl"><a class="docs-heading-anchor" href="#GPI2.jl">GPI2.jl</a><a id="GPI2.jl-1"></a><a class="docs-heading-anchor-permalink" href="#GPI2.jl" title="Permalink"></a></h1><p><a href="https://hlrs-tasc.github.io/GPI2.jl/stable"><img src="https://img.shields.io/badge/docs-stable-blue.svg" alt="Docs-stable"/></a> <a href="https://hlrs-tasc.github.io/GPI2.jl/dev"><img src="https://img.shields.io/badge/docs-dev-blue.svg" alt="Docs-dev"/></a> <a href="https://github.com/hlrs-tasc/GPI2.jl/actions/workflows/ci.yml"><img src="https://github.com/hlrs-tasc/GPI2.jl/actions/workflows/ci.yml/badge.svg" alt="Build Status"/></a> <a href="https://coveralls.io/github/hlrs-tasc/GPI2.jl?branch=main"><img src="https://coveralls.io/repos/github/hlrs-tasc/GPI2.jl/badge.svg?branch=main" alt="Coverage Status"/></a> <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-success.svg" alt="License: MIT"/></a></p><p>GPI2.jl is a lightweight Julia wrapper for the <a href="https://www.gaspi.de/">GASPI</a>-conforming <a href="https://github.com/cc-hpc-itwm/GPI-2">GPI-2</a> library.</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>If you have not yet installed Julia, please <a href="https://julialang.org/downloads/platform/">follow the instructions for your operating system</a>. GPI2.jl works with Julia v1.7. Since GPI-2 only works on Linux systems, GPI2.jl is also restricted to this platform.</p><p>GPI2.jl is a registered package. Thus to install it in your default environment, execute the following command:</p><pre><code class="language-shell hljs">julia -e &#39;using Pkg; Pkg.add(&quot;GPI2.jl&quot;)&#39;</code></pre><p>Alternatively, you can also just clone this repository and then instantiate it, i.e., installing all dependencies:</p><pre><code class="language-shell hljs">git clone https://github.com/hlrs-tasc/GPI2.jl.git
julia --project=GPI2.jl -e &#39;using Pkg; Pkg.instantiate()&#39;</code></pre><p>If you decide to use the latter approach with a cloned <code>GPI2.jl</code> directory, in the following, you need to add <code>--project=path/to/GPI2.jl</code> to the <code>julia</code> command, e.g.,</p><pre><code class="language-shell hljs">julia --project=. -e &#39;using GPI2; ...&#39;</code></pre><p>if you are starting Julia from within the <code>GPI2.jl</code> folder.</p><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><h3 id="Getting-started"><a class="docs-heading-anchor" href="#Getting-started">Getting started</a><a id="Getting-started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-started" title="Permalink"></a></h3><p>You can start running GASPI functions after executing <code>using GPI2</code>. All GASPI functions are prefixed by <code>gaspi_</code>. For example, to check the version of the currently used GPI-2 library, start the Julia REPL and paste the following snippet:</p><pre><code class="language-julia hljs">julia&gt; using GPI2

julia&gt; version = Ref{Cfloat}()
Base.RefValue{Float32}(0.0f0)

julia&gt; gaspi_version(version)
GASPI_SUCCESS::gaspi_return_t = 0

julia&gt; println(&quot;GPI-2 library version: $(version[])&quot;)
GPI-2 library version: 1.51</code></pre><h3 id="Parallel-execution"><a class="docs-heading-anchor" href="#Parallel-execution">Parallel execution</a><a id="Parallel-execution-1"></a><a class="docs-heading-anchor-permalink" href="#Parallel-execution" title="Permalink"></a></h3><p>To run a GPI-2 program in parallel, you need to start it with the helper script <code>gaspi_run</code>. It requires a machinefile with the names of the nodes on which a rank should be started, see also the GPI-2 <a href="https://github.com/cc-hpc-itwm/GPI-2">docs</a>. For a simple test, you can create a machinefile that will start three ranks on the current node by running</p><pre><code class="language-shell hljs">yes `hostname` | head -n 3 &gt; machinefile</code></pre><p>For convenience, GPI2.jl provides the function <code>gaspi_run()</code> that will start <code>gaspi_run</code> for you, using the GPI2_jll.jl-provided executable. GPI2.jl also provides some example files in the <a href="examples/">examples/</a> folder you can check out to get started.</p><p>For example, to run the <a href="examples/hello_world.jl"><code>hello_world.jl</code></a> example in parallel, execute the following commands from the GPI2.jl directory:</p><pre><code class="language-shell hljs">julia -e &#39;using GPI2; gaspi_run()&#39; -- -m machinefile $(which julia) $(pwd)/examples/hello_world.jl</code></pre><p>You need <code>julia</code> twice in the command: The first one just executes the <code>gaspi_run</code> command, while the second one is the command that is executed in parallel. You also need the <code>$(pwd)</code> to ensure that <code>gaspi_run</code> picks the right file.</p><h3 id="Issues-when-relying-on-the-module-command"><a class="docs-heading-anchor" href="#Issues-when-relying-on-the-module-command">Issues when relying on the <code>module</code> command</a><a id="Issues-when-relying-on-the-module-command-1"></a><a class="docs-heading-anchor-permalink" href="#Issues-when-relying-on-the-module-command" title="Permalink"></a></h3><p>If you want to start a parallel process using GPI-2&#39;s <code>gaspi_run</code> on a cluster where paths are set using the <code>module</code> command provided by, e.g., Lmod, there are some issues you need to handle in order to make a GASPI program run properly. They boil down to the fact that, as far as I can tell, GPI-2 uses SSH to set up communication between nodes and uses a non-login shell for this purpose. This means that, e.g., the <code>module</code> command will not work and thus you need to manually put all relevant changes to the environment variables directly in your <code>~/.bashrc</code> file.</p><p>As a workaround, this repository provides two auxiliary utilities: <a href="utils/storeenv.jl"><code>storeenv.jl</code></a> and <a href="utils/launcher.jl"><code>launcher.jl</code></a>. They help you to run a GPI-2-powered Julia program on a cluster with an environment modules setup by storing the entire environment and reloading it.</p><p>First, go to the folder from which you want to start your GASPI-parallelized Julia program and execute the <code>storeenv.jl</code> script:</p><pre><code class="language-shell hljs">julia path/to/storeenv.jl</code></pre><p>The <code>storeenv.jl</code> script will record the current environment variables and store them in a file <code>gaspi-jl-env.toml</code>.</p><p>Then, run your Julia program in parallel with the <code>launcher.jl</code> script using the following command:</p><pre><code class="language-shell hljs">julia -e &#39;using GPI2; gaspi_run()&#39; -- -m &lt;machinefile&gt; $(which julia) /abs/path/to/launcher.jl $(pwd)/gaspi-jl-env.toml path/to/julia/program.jl</code></pre><p>The <code>&lt;machinefile&gt;</code> is the normal machinefile with all nodes on which to start a GASPI rank. The <code>/abs/path/to/launcher.jl</code> must be an <em>absolute</em> path again. The launcher script will take care of recreating the environment using the information in the TOML file <code>$(pwd)/gaspi-jl-env.toml</code>. Finally, you can provide the path to the Julia programm (and optional command line arguments to it) as the final part. The path to the Julia program may be relative or absolute, since the launcher knows your current directory by now.</p><h2 id="Configuration"><a class="docs-heading-anchor" href="#Configuration">Configuration</a><a id="Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Configuration" title="Permalink"></a></h2><h3 id="Using-a-system-library"><a class="docs-heading-anchor" href="#Using-a-system-library">Using a system library</a><a id="Using-a-system-library-1"></a><a class="docs-heading-anchor-permalink" href="#Using-a-system-library" title="Permalink"></a></h3><p>When using GPI2.jl, you can specify the path to the GASPI library you want to use. By default, GPI2.jl uses the precompiled GPI-2 library available in the GPI2_jll.jl package. This is only recommended for non-performance critical usage and/or development. To switch to a library installed on your system, execute</p><pre><code class="language-julia hljs">julia -e &#39;using GPI2; GPI2.use_system_library(&quot;path/to/libGPI2.so&quot;)&#39;</code></pre><p>where <code>path/to/libGPI.so</code> should be the path to your <em>shared</em> GPI-2 library. To switch back to using the JLL-provided library, execute</p><pre><code class="language-julia hljs">julia -e &#39;using GPI2; GPI2.use_jll_library()&#39;</code></pre><p>After switching the library, you need to restart Julia for the changes to take effect.</p><h3 id="Generating-C-bindings"><a class="docs-heading-anchor" href="#Generating-C-bindings">Generating C bindings</a><a id="Generating-C-bindings-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-C-bindings" title="Permalink"></a></h3><p>In case you are using a system-provided GPI-2 library with an API that is different to the one provided by the JLL-provided library, you need to re-generate the C bindings file <code>LibGPI2.jl</code> and tell the GPI2.jl package to use it.</p><p>To this end, enter the <code>bindings/</code> directory and run the following command:</p><pre><code class="language-shell hljs">julia --project=. -e &#39;using Pkg; Pkg.instantiate()&#39; # only required once
GPI_INCLUDE_DIR=path/to/GPI-2/include julia --project=. generator.jl</code></pre><p>This will create a <code>LibGPI2.jl</code> file in the current working directory. To switch to the custom bindings file, execute</p><pre><code class="language-julia hljs">julia -e &#39;using GPI2; GPI2.use_system_bindings(&quot;path/to/LibGPI2.jl&quot;)&#39;</code></pre><p>where <code>path/to/libGPI.so</code> should be the path to your custom C bindings file. To switch back to using the JLL-compatible library, execute</p><pre><code class="language-julia hljs">julia -e &#39;using GPI2; GPI2.use_jll_bindings()&#39;</code></pre><p>After switching the C bindings, you need to restart Julia for the changes to take effect.</p><h2 id="Authors"><a class="docs-heading-anchor" href="#Authors">Authors</a><a id="Authors-1"></a><a class="docs-heading-anchor-permalink" href="#Authors" title="Permalink"></a></h2><p>GPI2.jl is maintained by <a href="https://www.hlrs.de/about-us/organization/divisions-departments/av/tasc/">Michael Schlottke-Lakemper</a> (University of Stuttgart, Germany). The GPI-2 library itself is developed by the <a href="https://www.itwm.fraunhofer.de/">Fraunhofer Institute for Industrial Mathematics (ITWM)</a>.</p><h2 id="License-and-contributing"><a class="docs-heading-anchor" href="#License-and-contributing">License and contributing</a><a id="License-and-contributing-1"></a><a class="docs-heading-anchor-permalink" href="#License-and-contributing" title="Permalink"></a></h2><p>GPI2.jl is published under the MIT license (see <a href="license/#License">License</a>). We are very happy to accept contributions from everyone, preferably in the form of a PR. <a href="https://github.com/cc-hpc-itwm/GPI-2">GPI-2</a> itself is published under the GNU General Public license, version 3.</p></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="reference/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.17 on <span class="colophon-date" title="Monday 23 May 2022 10:36">Monday 23 May 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
